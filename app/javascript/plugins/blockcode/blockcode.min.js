ArticleEditor,ArticleEditor.add("plugin","blockcode",{translations:{en:{blockcode:{save:"Save",cancel:"Cancel","edit-code":"Edit Code"}}},defaults:{codemirror:!1,icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m4.50635227 7.99625673 2.25498824 2.25498827c.39052429.3905243.39052429 1.0236892 0 1.4142135l-.05889346.0588935c-.39052429.3905243-1.02368927.3905243-1.41421356 0l-3.00510751-3.00510751c-.12243333-.12243333-.20648257-.26871548-.25214772-.42389275-.1113859-.34572988-.02983075-.74010429.24466546-1.01460051l3.00510751-3.00510751c.3905243-.39052429 1.02368927-.39052429 1.41421357 0l.05889346.05889347c.39052429.39052429.39052429 1.02368927 0 1.41421356z"/><path d="m11.5063523 7.99625673 2.2549882 2.25498827c.3905243.3905243.3905243 1.0236892 0 1.4142135l-.0588934.0588935c-.3905243.3905243-1.0236893.3905243-1.4142136 0l-3.00510752-3.00510751c-.12243333-.12243333-.20648257-.26871548-.25214772-.42389275-.1113859-.34572988-.02983075-.74010429.24466546-1.01460051l3.00510748-3.00510751c.3905243-.39052429 1.0236893-.39052429 1.4142136 0l.0588935.05889347c.3905242.39052429.3905242 1.02368927 0 1.41421356z" transform="matrix(-1 0 0 -1 23.036984 16)"/></svg>',popup:{adaptive:!0,form:{code:{type:"textarea",attr:{rows:8}}},header:"## blockcode.edit-code ##",footer:{insert:{title:"## blockcode.save ##",command:"blockcode.save"},cancel:{title:"## blockcode.cancel ##",command:"popup.close"}}}},init:function(){this.utils=this.app.create("utils"),this.content=this.app.create("content"),this.selection=this.app.create("selection")},start:function(){this.app.control.add("blockcode",{icon:this.opts.blockcode.icon,command:"blockcode.edit"})},edit:function(){this.app.popup.build(this.opts.blockcode.popup),this.app.popup.open();var t=this.app.block.get().$block.clone().get().outerHTML;t=this.content.unparse(t);var e=this.app.popup.getInput("code");e.addClass("arx-popup-event"),e.on("keydown.arx-popup-event-"+this.uuid,this._handleTab.bind(this)),e.val(t),e.focus(),this.utils.createCodemirror(e,this.opts.blockcode)},save:function(){this.app.popup.close();var t=this.app.block.get(),e=this.app.popup.getData().code;if(""!==(e=this.utils.getCodemirror(e,this.opts.blockcode))){var o=this.content.parse(e,!1,!0);this.selection.save(t.$block),t.$block.after(o);var i=this.app.editor.$editor.find("[data-arx-inserted]");t.$block.remove(),this.app.editor.rebuild();var c=i.first();this.app.block.set(c),i.removeAttr("data-arx-inserted"),this.selection.restore(c)}else t.remove()},_handleTab:function(t){if(9!==t.keyCode)return!0;t.preventDefault();var e=t.target,o=e.value,i=e.selectionStart;e.value=o.substring(0,i)+"    "+o.substring(e.selectionEnd),e.selectionStart=e.selectionEnd=i+4}});